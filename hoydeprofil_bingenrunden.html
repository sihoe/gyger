async function loadElevationData() {
    try {
        // Last inn elevasjonsdata
        const response = await fetch("https://raw.githubusercontent.com/sihoe/gyger/main/elevation_data.json");
        const elevationData = await response.json();

        // Klargjør data
        const distances = elevationData.map(d => +d.distance);
        const elevations = elevationData.map(d => +d.elevation);

        // Beregninger
        const highestPoint = Math.max(...elevations);
        const lowestPoint = Math.min(...elevations);
        const totalDistance = distances[distances.length - 1].toFixed(2);

        let totalAscent = 0, totalDescent = 0, slopes = [0], bgColors = ['transparent'];

        for (let i = 1; i < elevations.length; i++) {
            const deltaElev = elevations[i] - elevations[i - 1];
            const deltaDist = (distances[i] - distances[i - 1]) * 1000; // km til meter
            const slope = (deltaElev / deltaDist) * 100;
            slopes.push(slope);

            if (deltaElev > 0) {
                totalAscent += deltaElev;
                bgColors.push(slope > 5 ? '#CA6B2A' : slope > 2.5 ? '#F1B961' : 'transparent');
            } else {
                totalDescent += Math.abs(deltaElev);
                bgColors.push('transparent');
            }
        }

        // Fikse hull i fargingen
        for (let i = 1; i < bgColors.length - 1; i++) {
            if (bgColors[i] === 'transparent' && bgColors[i - 1] !== 'transparent' && bgColors[i + 1] !== 'transparent') {
                bgColors[i] = bgColors[i - 1];
            }
        }

        // Oppdater HTML-elementer med beregnede verdier
        document.getElementById('totalDistance').textContent = totalDistance;
        document.getElementById('totalAscent').textContent = totalAscent.toFixed(0);
        document.getElementById('totalDescent').textContent = totalDescent.toFixed(0);
        document.getElementById('highestPoint').textContent = highestPoint.toFixed(0);
        document.getElementById('lowestPoint').textContent = lowestPoint.toFixed(0);

        // Opprett og vis Chart.js-graf
        const ctx = document.getElementById('elevationChart').getContext('2d');
        const elevationChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: distances,
                datasets: [{
                    label: 'Høyde (moh)',
                    data: elevations,
                    borderColor: '#422426',
                    borderWidth: 1.5,
                    backgroundColor: 'rgba(66, 36, 38, 0.2)',
                    pointRadius: 0,
                    fill: true,
                    segment: {
                        backgroundColor: ctx => bgColors[ctx.p0DataIndex]
                    }
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: { display: true, text: 'Avstand (km)' },
                    },
                    y: {
                        title: { display: true, text: 'Høyde (moh)' },
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: ctx => `Høyde: ${ctx.parsed.y.toFixed(1)} moh`
                        }
                    }
                }
            }
        });

    } catch (error) {
        console.error('Feil ved lasting av data:', error);
        alert('Kunne ikke laste inn data.');
    }
}

// Kjør funksjonen ved lasting av siden
loadElevationData();


